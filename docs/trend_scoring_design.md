# 趋势评分系统设计文档

## 版本信息
- **当前版本**: v1.0.0
- **评分器**: MA+ADX Scorer
- **创建日期**: 2025-11-29
- **最后更新**: 2025-11-29

## 设计理念

Level 1 硬筛选的趋势评分系统采用独立模块设计，支持：
- 可插拔的评分器（类似策略系统）
- 配置驱动的权重调整
- 详细的评分元数据输出
- 版本化管理，方便迭代

## 当前评分器：MA+ADX Scorer v1.0.0

### 评分维度

#### 1. 均线排列（权重40%）

**评分规则**：
- 完美多头排列（Price > MA5 > MA10 > MA20 > MA50）：100分
- 三线多头（一条乱序）：75分
- 两线多头：50分
- 一线多头：25分
- 无排列：0分

**设计依据**：
均线是市场共识指标，多头排列反映中长期趋势向上。完美排列得满分，允许一条均线乱序体现灵活性。

#### 2. ADX强度（权重35%）

**评分规则**：
| ADX值 | +DI vs -DI | 得分 | 说明 |
|-------|-----------|------|------|
| 25-40 | +DI > -DI | 100 | 理想趋势强度 |
| 40-50 | +DI > -DI | 70 | 非常强但可能过热 |
| >50 | +DI > -DI | 50 | 过度狂热 |
| 20-25 | +DI > -DI | 60 | 趋势形成中 |
| <20 | +DI > -DI | 30 | 趋势太弱 |
| any | +DI < -DI | 0 | 下跌趋势，拒绝 |

**设计依据**：
ADX衡量趋势强度。25-40是经典的强趋势区间，过高可能接近顶部。必须+DI>-DI确保上涨方向。

#### 3. 价格动量（权重15%）

**评分规则**：
- 5日涨幅 ≥10%：100分
- 5日涨幅 5-10%：70分
- 5日涨幅 2-5%：50分
- 5日涨幅 0-2%：30分
- 5日涨幅 <0%：0分

**设计依据**：
近期涨幅反映动量，但权重较低因为可能导致"追高"。

#### 4. 价格位置（权重10%）

**相对位置计算**：
```
position = (current_price - low_20d) / (high_20d - low_20d)
```

**评分规则**：
- 位置 0.5-0.75：100分（理想区间，有空间）
- 位置 0.75-0.85：80分（偏高但可接受）
- 位置 0.3-0.5：60分（刚突破）
- 位置 >0.85：30分（可能过高）
- 位置 <0.3：20分（低位徘徊）

**设计依据**：
价格在20日区间的中高位最佳，既确认了突破，又有上涨空间。过高（>85%）有回调风险。

### 总分计算

```
总分 = (均线分 × 0.40) + (ADX分 × 0.35) + (动量分 × 0.15) + (位置分 × 0.10)
```

范围：0-100分

### 输出格式

```json
{
  "total": 85.5,
  "components": {
    "ma_alignment": {
      "score": 100,
      "weight": 0.40,
      "weighted_score": 40.0,
      "details": {
        "status": "perfect_bullish",
        "alignment_count": 4,
        "price": 185.50,
        "ma5": 183.20,
        "ma10": 180.50,
        "ma20": 178.30,
        "ma50": 170.20
      }
    },
    "adx_strength": {...},
    "price_momentum": {...},
    "price_position": {...}
  },
  "pass_threshold": true,
  "details": {
    "scorer": "ma_adx",
    "version": "1.0.0"
  }
}
```

## 综合评分系统

### 最终得分组成

Level 1 最终输出的每只股票包含：

```json
{
  "ticker": "AAPL",
  "timestamp": "2025-11-29T12:00:00",
  "basic_info": {
    "price": 185.50
  },
  "liquidity_score": 95.0,
  "trend_score": {...},
  "strategy_signals": [...],
  "signal_score": 85.0,
  "multi_strategy_score": 70.0,
  "final_score": {
    "total": 82.5,
    "components": {
      "liquidity": 19.0,
      "trend": 25.65,
      "signal": 34.0,
      "multi_strategy": 7.0
    },
    "rank": 5,
    "confidence": "high"
  }
}
```

### 综合评分权重

| 维度 | 权重 | 说明 |
|-----|------|------|
| 流动性 | 20% | 保证可交易性 |
| 趋势 | 30% | 趋势是核心 |
| 信号 | 40% | 技术信号是触发器 |
| 多策略共振 | 10% | 多重验证加分 |

### 置信度计算

- **高置信度**: 总分≥80 且 趋势分≥70 且 ≥2个策略
- **中等置信度**: 总分≥65 且 趋势分≥50
- **低置信度**: 其他

## 迭代实验记录

### 实验 #001 - 初始版本
- **日期**: 2025-11-29
- **配置**: 使用推荐权重
- **假设**: 均线+ADX组合能有效识别趋势
- **结果**: 待回测验证

## 未来扩展方向

### 短期（1-2周）
- [ ] 添加多周期验证（周线趋势确认）
- [ ] 实验不同的权重组合
- [ ] 添加sector/行业信息
- [ ] TODO: 小盘股流动性相对指标

### 中期（1个月）
- [ ] 开发基于动量+回归的评分器
- [ ] A/B测试对比不同评分器
- [ ] 根据回测结果优化参数
- [ ] 添加回测系统

### 长期（3个月）
- [ ] 动态权重调整（基于市场环境）
- [ ] 机器学习评分器
- [ ] 多评分器ensemble

## 参数调整指南

### 如何调整权重

编辑 `config/config.yaml`：
```yaml
screening:
  trend_scorer:
    weights:
      ma_alignment: 0.40  # 调整这里
      adx_strength: 0.35
      price_momentum: 0.15
      price_position: 0.10
```

### 如何切换评分器

未来有多个评分器时：
```yaml
screening:
  trend_scorer:
    type: "momentum_regression"  # 切换评分器
```

### 如何添加新评分器

1. 在 `src/trend_scoring/` 创建新文件，如 `momentum_scorer.py`
2. 继承 `BaseTrendScorer`
3. 实现 `score()` 和 `get_required_indicators()`
4. 在 `__init__.py` 中导出
5. 在配置中使用

示例代码：
```python
from .base_scorer import BaseTrendScorer

class MomentumScorer(BaseTrendScorer):
    VERSION = "1.0.0"
    NAME = "momentum"
    
    def score(self, df: pd.DataFrame) -> Dict:
        # 实现评分逻辑
        pass
    
    def get_required_indicators(self) -> List[str]:
        return ['close', 'volume', 'rsi']
```

## 硬过滤器说明

### 流动性过滤器

**门槛**：
- 最小日均成交额：100万美元
- 最小价格：$5.0

**评分**：
- ≥1000万美元：100分
- 100万-1000万：60-100分线性插值

### 趋势硬门槛

**必须满足**：
- 20日涨幅 ≥ 0%
- 价格 > MA50
- MA20向上（5日斜率>0）

不满足任何一条直接过滤。

## 技术债务和已知限制

- ⚠️ 小盘股流动性评分可能偏低（未来需要相对流动性指标）
- ⚠️ ADX计算复杂度较高（考虑缓存优化）
- ⚠️ 价格位置在横盘市场可能失效（需要额外验证）
- ⚠️ 缺少对财报日期的考虑（可能在财报前后产生噪音）
- ⚠️ 当前使用5日涨幅作为动量，可能改为20日更合理

## 参考资料

- ADX指标详解：[Investopedia - ADX](https://www.investopedia.com/terms/a/adx.asp)
- 均线系统：经典技术分析理论
- 趋势跟踪策略：Turtle Trading System
- Wilder's Smoothing：用于ADX计算

## 版本历史

### v1.0.0 (2025-11-29)
- 初始版本
- 实现MA+ADX评分器
- 实现综合评分引擎
- 实现硬过滤器
- JSON格式输出

---

**维护者**：AI Assistant
**最后更新**：2025-11-29

